<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚ú® cool website ‚ú®</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
  <link rel="icon" href="https://i.pinimg.com/236x/33/37/04/33370449505bdcd2c6f2ccdaf375692f.jpg" />
  <style>
    /* BASE STYLES */
    body {
      background-image: url('https://i.pinimg.com/736x/86/a6/e4/86a6e411d9a66382434556ef07df5c15.jpg');
      background-size: cover;
      background-attachment: fixed;
      font-family: 'Pacifico', cursive;
      text-align: center;
      color: #5B3A29;
      padding: 20px;
      min-height: 100vh;
      margin: 0;
      transition: all 0.5s ease;
    }
    body.pink { 
      background-image: url('https://i.pinimg.com/736x/0f/52/7c/0f527c1e0539c60ec3262bbae902a2df.jpg');
      background-color: rgba(255, 182, 193, 0.3); 
    }
    body.blue { 
      background-image: url('https://i.pinimg.com/originals/fd/72/e8/fd72e83b6412121b376b87021ee4e6f7.png');
      background-color: rgba(173, 216, 230, 0.3); 
    }
    body.dark-mode {
      background-image: url('https://wallpapercave.com/wp/wp5403837.jpg');
      color: #eee;
    }
    body.dark-mode .container,
    body.dark-mode #messagesDisplay,
    body.dark-mode .news-ticker,
    body.dark-mode #timeDisplay {
      background-color: rgba(0, 0, 0, 0.7);
      color: #eee;
    }
    body.dark-mode input[type="text"] {
      background-color: rgba(50, 50, 50, 0.8);
      color: #eee;
      border-color: #555;
    }
    /* TEXT INPUT STYLES */
    input[type="text"] {
      font-family: 'Pacifico', cursive;
      padding: 8px 12px;
      border-radius: 8px;
      border: 2px solid #ffcc99;
      background-color: rgba(255, 255, 255, 0.8);
      margin: 5px 0;
      width: 200px;
      transition: all 0.3s;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #ffb366;
      box-shadow: 0 0 10px rgba(255, 179, 102, 0.5);
    }
    /* BUTTON STYLES */
    button {
      font-family: 'Pacifico', cursive;
      background-color: #ffcc99;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      margin: 5px;
      color: #5B3A29;
      font-size: 16px;
    }
    button:hover {
      background-color: #ffb366;
      box-shadow: 0 0 15px rgba(255, 153, 102, 0.8);
      transform: translateY(-2px);
    }
    /* TIME BUTTON STYLES */
    .time-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 15px auto;
    }
    #timeButton {
      background-color: #ffcc99;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      margin: 10px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #timeButton:hover {
      background-color: #ffb366;
      box-shadow: 0 0 15px rgba(255, 153, 102, 0.8);
    }
    #timeDisplay {
      font-size: 24px;
      margin: 10px 0;
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      display: inline-block;
      min-width: 150px;
    }
    /* INSTANT MARQUEE */
    .news-ticker {
      background: rgba(255, 255, 255, 0.7);
      padding: 10px;
      margin: 0 auto 20px auto;
      border-radius: 10px;
      max-width: 800px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
      z-index: 100;
    }
    .marquee {
      color: #5B3A29;
      font-size: 18px;
      white-space: nowrap;
      display: inline-block;
      animation: marquee 10s linear infinite;
    }
    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    /* ANNOUNCEMENT STYLES */
    .announcement {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 182, 193, 0.95);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255, 105, 180, 0.6);
      z-index: 9998;
      color: #5B3A29;
      font-size: 18px;
    }
    /* ROTATING CUBE */
    .rotating-cube {
      width: 100px;
      height: 100px;
      margin: 20px auto;
      position: relative;
      transform-style: preserve-3d;
      animation: rotate 6s infinite linear;
    }
    .cube-face {
      position: absolute;
      width: 100px;
      height: 100px;
      background: url('https://i.pinimg.com/474x/f8/05/1d/f8051d752caa2f99e2f6a183ca71383c.jpg') center/cover no-repeat;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .front  { transform: translateZ(50px); }
    .back   { transform: translateZ(-50px) rotateY(180deg); }
    .right  { transform: rotateY(90deg) translateZ(50px); }
    .left   { transform: rotateY(-90deg) translateZ(50px); }
    .top    { transform: rotateX(90deg) translateZ(50px); }
    .bottom { transform: rotateX(-90deg) translateZ(50px); }
    @keyframes rotate {
      from { transform: rotateX(0deg) rotateY(0deg); }
      to { transform: rotateX(360deg) rotateY(360deg); }
    }
    /* ADMIN PANEL */
    .admin-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255, 182, 193, 0.95);
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(255, 105, 180, 0.6);
      z-index: 9999;
      max-height: 80vh;
      overflow-y: auto;
      width: 320px;
      border: 3px solid white;
      display: none;
    }
    /* ICON STACK */
    .icon-stack {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      z-index: 10000;
    }
    .admin-toggle {
      background: #ff69b4;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      transition: transform 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .admin-toggle:hover {
      transform: rotate(90deg);
    }
    .theme-toggle {
      background: #5B3A29;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .theme-toggle:hover {
      transform: scale(1.1);
    }
    body.dark-mode .theme-toggle {
      background: #eee;
      color: #222;
    }
    .admin-section {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 2px dashed #ff69b4;
    }
    .admin-section h4 {
      margin: 5px 0 10px 0;
      color: #5B3A29;
      text-align: center;
    }
    .admin-panel button {
      background: white;
      color: #ff69b4;
      border: none;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 8px;
      font-family: 'Pacifico', cursive;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      width: calc(50% - 10px);
      display: inline-block;
    }
    .admin-panel button:hover {
      background: #ff69b4;
      color: white;
      transform: translateY(-2px);
    }
    /* CONTENT STYLES */
    .content-layer {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }
    .container {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    /* CHAT STYLES */
    .message-board {
      margin: 20px auto;
      max-width: 90%;
    }
    #messagesDisplay {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      padding: 15px;
      min-height: 50px;
      max-height: 200px;
      overflow-y: auto;
      text-align: left;
    }
    .message {
      margin-bottom: 8px;
      padding: 5px;
      border-bottom: 1px dashed #ffcc99;
      transition: all 0.3s;
    }
    .message-name {
      font-weight: bold;
      color: #D2691E;
    }
    .message-time {
      font-size: 12px;
      color: #888;
    }
    /* SPECIAL STATES */
    .user-warning {
      background-color: #fff3cd !important;
      border-left: 5px solid #ffc107 !important;
      animation: warnFlash 0.5s 3;
    }
    @keyframes warnFlash {
      0%, 100% { background-color: #fff3cd; }
      50% { background-color: #ffeeba; }
    }
    .muted-user {
      opacity: 0.6;
      filter: grayscale(50%);
    }
    .slow-mode-active {
      position: fixed;
      top: 60px;
      right: 20px;
      background: #ff5555;
      color: white;
      padding: 5px 10px;
      border-radius: 10px;
      z-index: 9998;
      font-size: 12px;
      box-shadow: 0 0 10px rgba(255,0,0,0.3);
    }
    /* MUSIC PLAYER */
    .music-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      align-items: center;
    }
    /* FLOATING CATS */
    .floating-cat {
      position: fixed;
      width: 40px;
      height: 40px;
      background-image: url('https://i.pinimg.com/474x/f8/05/1d/f8051d752caa2f99e2f6a183ca71383c.jpg');
      background-size: contain;
      background-repeat: no-repeat;
      pointer-events: none;
      z-index: 1;
      animation: float 3s linear infinite;
    }
    @keyframes float {
      0% { 
        transform: translate(0, 0) rotate(0deg);
        opacity: 1;
      }
      100% { 
        transform: translate(110vw, -10vh) rotate(360deg);
        opacity: 0;
      }
    }
    /* BAN SCREEN */
    .ban-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 99999;
      color: white;
      font-family: 'Pacifico', cursive;
      text-align: center;
      padding: 20px;
    }
    .ban-screen img {
      max-width: 200px;
      margin-bottom: 20px;
      border-radius: 10px;
    }
    .ban-screen h1 {
      color: #ff5555;
      margin-bottom: 10px;
    }
    .ban-screen p {
      margin: 5px 0;
    }
    /* YOUTUBE LINK */
    .yt-link {
      color: #5B3A29;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s;
      display: inline-block;
      margin: 10px 0;
    }
    .yt-link:hover {
      text-decoration: underline;
      transform: scale(1.05);
    }
    body.dark-mode .yt-link {
      color: #ffcc99;
    }
  </style>
</head>
<body>
  <!-- INSTANT MARQUEE -->
  <div class="news-ticker">
    <div class="marquee" id="tickerText">
      ‚ú® Welcome to the cool website! ‚ú®     
      ‚ú® Please be nice in the chat! ‚ú®     
      ‚ú® Check out the YouTube channel below! ‚ú®     
      ‚ú® Enjoy the music player! ‚ú®     
      ‚ú® Have fun! ‚ú®
    </div>
  </div>

  <!-- ICON STACK -->
  <div class="icon-stack">
    <button class="theme-toggle" id="themeToggle">üåì</button>
    <button class="admin-toggle" id="adminToggle" style="display: none;">‚öôÔ∏è</button>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin-panel" id="adminPanel">
    <h3 style="text-align:center;margin-top:0;">‚ú® ADMIN CONTROL CENTER ‚ú®</h3>
    <!-- CHAT CONTROLS -->
    <div class="admin-section">
      <h4>üí¨ CHAT CONTROLS</h4>
      <button onclick="clearChat()">üßπ Clear Chat</button>
      <button onclick="removeLastMessage()">‚Ü©Ô∏è Undo Last</button>
      <button onclick="toggleBadWords()" id="badWordsToggle">üîû Filter: ON</button>
      <button onclick="toggleSlowMode()" id="slowModeToggle">üê¢ Slow Mode: OFF</button>
      <button onclick="exportChat()">üì• Export Log</button>
      <button onclick="setCustomMarquee()">üì¢ Custom Ticker</button>
    </div>
    <!-- USER MANAGEMENT -->
    <div class="admin-section">
      <h4>üë• USER MANAGEMENT</h4>
      <button onclick="warnUser()">‚ö†Ô∏è Warn User</button>
      <button onclick="muteUser()">üîá Mute User</button>
      <button onclick="banUser()">üî® Ban User</button>
      <button onclick="unbanAll()">‚ù§Ô∏è Unban All</button>
      <button onclick="viewBannedUsers()">üìú Banned List</button>
    </div>
    <!-- APPEARANCE -->
    <div class="admin-section">
      <h4>üé® APPEARANCE</h4>
      <button onclick="changeTheme('pink')">üå∏ Pink Theme</button>
      <button onclick="changeTheme('blue')">üíô Blue Theme</button>
      <button onclick="changeTheme('default')">üåà Default</button>
      <button onclick="toggleFloatingCats()" id="catsToggle">üê± Cats: ON</button>
    </div>
    <!-- SPECIAL POWERS -->
    <div class="admin-section">
      <h4>‚ö° SPECIAL POWERS</h4>
      <button onclick="sendAnnouncement()">üì¢ Announcement</button>
      <button onclick="forcePlayMusic()">üéµ Force Music</button>
    </div>
    <!-- ADMIN TOOLS -->
    <div class="admin-section">
      <h4>üîê ADMIN TOOLS</h4>
      <button onclick="adminLogout()">üö™ Logout</button>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="content-layer">
    <div class="container">
      <h1>‚ú® cool website ‚ú®</h1>
      <h3>welcome to the cool website! its awesome, right?</h3>
      <b><p>this website gets daily updates :D</p></b>
      <a href="https://www.youtube.com/@afghani_munchkin" target="_blank" class="yt-link">‚û°Ô∏è visit this awesome YouTube channel ‚¨ÖÔ∏è</a>
      <p>welcome to the global chat! please no hurtful words!!!</p>
      <div class="message-board">
        <div class="message-input">
          <div>
            <label for="userName">enter a nickname (dont use your real name!) :</label>
            <input type="text" id="userName" placeholder="Your nickname">
          </div>
          <div style="margin-top: 10px;">
            <label for="userMessage">Type your message:</label>
            <input type="text" id="userMessage" placeholder="Say something nice...">
            <button onclick="saveMessage()">send</button>
          </div>
        </div>
        <div id="messagesDisplay">No messages yet. Be the first to chat!</div>
      </div>
      <!-- Music Player -->
      <div class="music-buttons">
        <button onclick="playMusic('song1')">Play Song 1</button>
        <button onclick="playMusic('song2')">Play Song 2</button>
        <button onclick="playMusic('song3')">Play Song 3</button>
        <button onclick="playMusic('song4')">Play Song 4</button>
        <button onclick="playMusic('song5')">Play Song 5</button>
        <button onclick="playMusic('song6')">Play Song 6</button>
        <button onclick="stopMusic()">Stop Music</button>
        <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1" oninput="setVolume(this.value)">
        <button onclick="toggleMute()">üîá Mute/Unmute</button>
      </div>
      <audio id="song1" src="https://vgmsite.com/soundtracks/sanrio-puroland-waku-waku-okaimono-suteki-na-oheya-o-tsukuri-masho-2010-nds-gamerip/ltzfymryfx/05%20-%20BGM000.mp3"></audio>
      <audio id="song2" src="https://vgmsite.com/soundtracks/sanrio-puroland-waku-waku-okaimono-suteki-na-oheya-o-tsukuri-masho-2010-nds-gamerip/lqclzfqvuj/10%20-%20BGM005.mp3"></audio>
      <audio id="song3" src="https://vgmsite.com/soundtracks/sanrio-puroland-waku-waku-okaimono-suteki-na-oheya-o-tsukuri-masho-2010-nds-gamerip/lcfvvoswow/09%20-%20BGM004.mp3"></audio>
      <audio id="song4" src="https://vgmsite.com/soundtracks/sanrio-puroland-waku-waku-okaimono-suteki-na-oheya-o-tsukuri-masho-2010-nds-gamerip/etbfrdqlcm/25%20-%20BGM021.mp3"></audio>
      <audio id="song5" src="https://vgmsite.com/soundtracks/sanrio-puroland-waku-waku-okaimono-suteki-na-oheya-o-tsukuri-masho-2010-nds-gamerip/qbswmqyssd/13%20-%20BGM008.mp3"></audio>
      <audio id="song6" src="https://vgmsite.com/soundtracks/sanrio-puroland-waku-waku-okaimono-suteki-na-oheya-o-tsukuri-masho-2010-nds-gamerip/fqvsaxobny/31%20-%20BGM028.mp3"></audio>
      <!-- Time Display -->
      <div class="time-container">
        <button id="timeButton">show the time</button>
        <div id="timeDisplay"></div>
      </div>
      <!-- Rotating Cube -->
      <div class="rotating-cube">
        <div class="cube-face front"></div>
        <div class="cube-face back"></div>
        <div class="cube-face right"></div>
        <div class="cube-face left"></div>
        <div class="cube-face top"></div>
        <div class="cube-face bottom"></div>
      </div>
      <p>thx for visiting my website <3</p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // ======================
    // FIREBASE CONFIGURATION
    // ======================
    const firebaseConfig = {
      apiKey: "AIzaSyD3RX465yKlHYCIur0_GiDmtcHds4Jq04Y",
      authDomain: "sanrio-global-chat.firebaseapp.com",
      databaseURL: "https://sanrio-global-chat-default-rtdb.firebaseio.com",
      projectId: "sanrio-global-chat",
      storageBucket: "sanrio-global-chat.firebasestorage.app",
      messagingSenderId: "842022490271",
      appId: "1:842022490271:web:86fe18373aabeae84f52aa",
      measurementId: "G-2K6FKNTS36"
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ======================
    // GLOBAL VARIABLES & STATES
    // ======================
    let isAdmin = false;
    let badWordsEnabled = true;
    let slowModeEnabled = false;
    let floatingCatsEnabled = true;
    let currentAudio = null;
    let darkMode = false;
    let announcementDiv = null;
    let bannedUsers = [];
    let mutedUsers = [];
    let lastMessageTime = 0;
    let slowModeCooldown = 5000; // 5 seconds for slow mode

    // Check local storage for admin status
    function checkAdminStatus() {
      // Reset admin status on each page load
      localStorage.removeItem('isAdmin');
      isAdmin = false;
      document.getElementById('adminToggle').style.display = 'none';
      document.getElementById('adminPanel').style.display = 'none';
    }

    // ======================
    // DOM ELEMENTS
    // ======================
    const adminToggle = document.getElementById('adminToggle');
    const adminPanel = document.getElementById('adminPanel');
    const themeToggle = document.getElementById('themeToggle');
    const timeButton = document.getElementById('timeButton');
    const timeDisplay = document.getElementById('timeDisplay');

    // ======================
    // ADMIN PANEL & THEME TOGGLING
    // ======================
    adminToggle.addEventListener('click', () => {
      adminPanel.style.display = adminPanel.style.display === 'block' ? 'none' : 'block';
    });

    themeToggle.addEventListener('click', () => {
      darkMode = !darkMode;
      if (darkMode) {
        document.body.classList.add('dark-mode');
        themeToggle.textContent = '‚òÄÔ∏è';
      } else {
        document.body.classList.remove('dark-mode');
        themeToggle.textContent = 'üåì';
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'z' && !isAdmin) { // Changed from 'a' to 'z'
        const password = prompt("Enter admin password:");
        if (password === "hadido") {
          isAdmin = true;
          adminToggle.style.display = 'flex';
          alert("Admin mode activated! ‚ú®");
        } else {
          alert("Wrong password!");
        }
      }
    });

    // ======================
    // TIME DISPLAY FUNCTION
    // ======================
    timeButton.addEventListener('click', () => {
      const now = new Date();
      timeDisplay.textContent = now.toLocaleTimeString();
    });

    // ======================
    // MUSIC PLAYER FUNCTIONS
    // ======================
    function playMusic(songId) {
      if (currentAudio && currentAudio.id !== songId) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }
      currentAudio = document.getElementById(songId);
      currentAudio.loop = true;
      currentAudio.volume = document.getElementById('volumeSlider').value;
      currentAudio.play().catch(error => {
        console.error("Audio playback failed:", error);
        alert("Sorry, couldn't play audio. Try clicking on the page first!");
      });
    }

    function stopMusic() {
      if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio = null;
      }
    }

    function toggleMute() {
      if (currentAudio) {
        currentAudio.muted = !currentAudio.muted;
      }
    }

    function setVolume(value) {
      if (currentAudio) {
        currentAudio.volume = value;
      }
    }

    // Force play music function for admin
    function forcePlayMusic() {
      if (isAdmin) {
        const songNumber = prompt("Enter song number (1-6):");
        if (songNumber && songNumber >= 1 && songNumber <= 6) {
          playMusic('song' + songNumber);
          sendAnnouncement("üéµ Admin is playing music for everyone! üéµ");
        }
      }
    }

    // ======================
    // CHAT FUNCTIONS
    // ======================
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.appendChild(document.createTextNode(text));
      return div.innerHTML;
    }

    function initializeMessages() {
      const messagesDisplay = document.getElementById('messagesDisplay');
      // Clear any existing messages and set default text
      messagesDisplay.innerHTML = 'No messages yet. Be the first to chat!';
      
      // Set up listener for new messages
      database.ref('messages').on('value', (snapshot) => {
        const data = snapshot.val();
        
        // If no messages exist, keep default text
        if (!data) {
          messagesDisplay.innerHTML = 'No messages yet. Be the first to chat!';
          return;
        }
        
        // Clear display before adding messages
        messagesDisplay.innerHTML = '';
        
        // Loop through all messages
        Object.keys(data).forEach(key => {
          const messageData = data[key];
          const messageDiv = document.createElement('div');
          messageDiv.classList.add('message');
          messageDiv.innerHTML = '<span class="message-name">' + escapeHtml(messageData.name) + ': </span>' +
                              '<span class="message-text">' + escapeHtml(messageData.message) + '</span>' +
                              '<div class="message-time">' + new Date(messageData.timestamp).toLocaleTimeString() + '</div>';
          messagesDisplay.appendChild(messageDiv);
        });
        
        messagesDisplay.scrollTop = messagesDisplay.scrollHeight;
      });
    }

    function filterBadWords(text) {
      if (!badWordsEnabled) return text;
      
      const badWords = ['bad', 'function filterBadWords(text) {
      if (!badWordsEnabled) return text;
      
      const badWords = ['bad', 'mean', 'ugly', 'hate', 'stupid', 'dumb', 'idiot'];
      let filteredText = text;
      
      badWords.forEach(word => {
        const regex = new RegExp('\\b' + word + '\\b', 'gi');
        filteredText = filteredText.replace(regex, '***');
      });
      
      return filteredText;
    }

    function saveMessage() {
      const userName = document.getElementById('userName').value.trim();
      const userMessage = document.getElementById('userMessage').value.trim();
      
      // Basic validation
      if (!userName || !userMessage) {
        alert("Please enter both your name and a message!");
        return;
      }
      
      // Check if user is banned
      if (bannedUsers.includes(userName.toLowerCase())) {
        showBanScreen(userName);
        return;
      }
      
      // Check if user is muted
      if (mutedUsers.includes(userName.toLowerCase())) {
        alert("You are currently muted and cannot send messages.");
        return;
      }
      
      // Check for slow mode
      if (slowModeEnabled) {
        const now = Date.now();
        if (now - lastMessageTime < slowModeCooldown) {
          alert("Slow mode is active! Please wait a few seconds before sending another message.");
          return;
        }
        lastMessageTime = now;
      }
      
      // Filter bad words
      const filteredMessage = filterBadWords(userMessage);
      
      // Save to Firebase
      const newMessageRef = database.ref('messages').push();
      newMessageRef.set({
        name: userName,
        message: filteredMessage,
        timestamp: Date.now()
      });
      
      // Clear message input
      document.getElementById('userMessage').value = '';
    }

    // Function to toggle badWords filter
    function toggleBadWords() {
      if (!isAdmin) return;
      
      badWordsEnabled = !badWordsEnabled;
      document.getElementById('badWordsToggle').textContent = badWordsEnabled ? "üîû Filter: ON" : "üîû Filter: OFF";
    }

    // Function to toggle slow mode
    function toggleSlowMode() {
      if (!isAdmin) return;
      
      slowModeEnabled = !slowModeEnabled;
      document.getElementById('slowModeToggle').textContent = slowModeEnabled ? "üê¢ Slow Mode: ON" : "üê¢ Slow Mode: OFF";
      
      if (slowModeEnabled) {
        const slowModeDiv = document.createElement('div');
        slowModeDiv.classList.add('slow-mode-active');
        slowModeDiv.id = 'slowModeIndicator';
        slowModeDiv.textContent = "Slow Mode Active";
        document.body.appendChild(slowModeDiv);
      } else {
        const indicator = document.getElementById('slowModeIndicator');
        if (indicator) indicator.remove();
      }
    }

    // Function to clear chat
    function clearChat() {
      if (!isAdmin) return;
      
      if (confirm("Are you sure you want to clear all chat messages?")) {
        database.ref('messages').remove();
      }
    }

    // Function to remove last message
    function removeLastMessage() {
      if (!isAdmin) return;
      
      database.ref('messages').limitToLast(1).once('value', snapshot => {
        snapshot.forEach(child => {
          database.ref('messages/' + child.key).remove();
        });
      });
    }

    // Function to show ban screen
    function showBanScreen(username) {
      const banScreen = document.createElement('div');
      banScreen.classList.add('ban-screen');
      banScreen.innerHTML = `
        <img src="https://i.pinimg.com/236x/33/37/04/33370449505bdcd2c6f2ccdaf375692f.jpg" alt="Banned">
        <h1>‚ö†Ô∏è YOU ARE BANNED! ‚ö†Ô∏è</h1>
        <p>Sorry ${escapeHtml(username)}, you have been banned from the chat.</p>
        <p>Please be nicer next time!</p>
      `;
      document.body.appendChild(banScreen);
      
      setTimeout(() => {
        banScreen.remove();
      }, 5000);
    }

    // Function to ban a user
    function banUser() {
      if (!isAdmin) return;
      
      const username = prompt("Enter username to ban:");
      if (!username) return;
      
      if (!bannedUsers.includes(username.toLowerCase())) {
        bannedUsers.push(username.toLowerCase());
        sendAnnouncement(`User ${username} has been banned! üò±`);
      }
    }

    // Function to mute a user
    function muteUser() {
      if (!isAdmin) return;
      
      const username = prompt("Enter username to mute:");
      if (!username) return;
      
      if (!mutedUsers.includes(username.toLowerCase())) {
        mutedUsers.push(username.toLowerCase());
        sendAnnouncement(`User ${username} has been muted for 5 minutes! ü§ê`);
        
        // Auto unmute after 5 minutes
        setTimeout(() => {
          const index = mutedUsers.indexOf(username.toLowerCase());
          if (index > -1) {
            mutedUsers.splice(index, 1);
            sendAnnouncement(`User ${username} has been unmuted! üéâ`);
          }
        }, 5 * 60 * 1000);
      }
    }

    // Function to warn a user
    function warnUser() {
      if (!isAdmin) return;
      
      const username = prompt("Enter username to warn:");
      if (!username) return;
      
      // Find user's messages and add warning class
      const messages = document.querySelectorAll('.message');
      messages.forEach(msg => {
        const nameElement = msg.querySelector('.message-name');
        if (nameElement && nameElement.textContent.toLowerCase().includes(username.toLowerCase())) {
          msg.classList.add('user-warning');
        }
      });
      
      sendAnnouncement(`‚ö†Ô∏è ${username} has received a warning! Please follow the chat rules!`);
    }

    // Function to unban all users
    function unbanAll() {
      if (!isAdmin) return;
      
      if (confirm("Unban all users?")) {
        bannedUsers = [];
        sendAnnouncement("All users have been unbanned! üéâ");
      }
    }

    // Function to view banned users
    function viewBannedUsers() {
      if (!isAdmin) return;
      
      if (bannedUsers.length === 0) {
        alert("No users are currently banned.");
      } else {
        alert("Banned users: " + bannedUsers.join(", "));
      }
    }

    // Function to export chat log
    function exportChat() {
      if (!isAdmin) return;
      
      database.ref('messages').once('value', snapshot => {
        const data = snapshot.val();
        if (!data) {
          alert("No messages to export!");
          return;
        }
        
        let exportText = "===== CHAT EXPORT =====\n\n";
        Object.keys(data).forEach(key => {
          const messageData = data[key];
          const date = new Date(messageData.timestamp).toLocaleString();
          exportText += `[${date}] ${messageData.name}: ${messageData.message}\n`;
        });
        
        const blob = new Blob([exportText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'chat_export.txt';
        a.click();
        URL.revokeObjectURL(url);
      });
    }

    // Function to set custom marquee text
    function setCustomMarquee() {
      if (!isAdmin) return;
      
      const newText = prompt("Enter new ticker text:");
      if (newText) {
        document.getElementById('tickerText').textContent = newText;
      }
    }

    // Function to send announcement
    function sendAnnouncement(customMessage = null) {
      if ((!isAdmin) && (!customMessage)) return;
      
      // Remove previous announcement if exists
      if (announcementDiv) {
        announcementDiv.remove();
      }
      
      const message = customMessage || prompt("Enter announcement message:");
      if (!message) return;
      
      announcementDiv = document.createElement('div');
      announcementDiv.classList.add('announcement');
      announcementDiv.innerHTML = `<span>üì¢ ANNOUNCEMENT: ${escapeHtml(message)}</span>`;
      document.body.appendChild(announcementDiv);
      
      setTimeout(() => {
        announcementDiv.remove();
        announcementDiv = null;
      }, 5000);
    }

    // Function to change theme
    function changeTheme(theme) {
      if (!isAdmin) return;
      
      // First, remove all theme classes
      document.body.classList.remove('pink', 'blue');
      
      // Then add the selected theme class
      if (theme !== 'default') {
        document.body.classList.add(theme);
      }
    }

    // Function to toggle floating cats
    function toggleFloatingCats() {
      if (!isAdmin) return;
      
      floatingCatsEnabled = !floatingCatsEnabled;
      document.getElementById('catsToggle').textContent = floatingCatsEnabled ? "üê± Cats: ON" : "üê± Cats: OFF";
      
      if (floatingCatsEnabled) {
        spawnFloatingCats();
      } else {
        // Remove all existing floating cats
        document.querySelectorAll('.floating-cat').forEach(cat => cat.remove());
      }
    }

    // Function to spawn floating cats
    function spawnFloatingCats() {
      if (!floatingCatsEnabled) return;
      
      const cat = document.createElement('div');
      cat.classList.add('floating-cat');
      cat.style.left = '-40px';
      cat.style.top = Math.random() * window.innerHeight + 'px';
      document.body.appendChild(cat);
      
      // Remove cat element after animation completes
      setTimeout(() => {
        cat.remove();
      }, 3000);
      
      // Spawn a new cat every few seconds
      setTimeout(spawnFloatingCats, Math.random() * 3000 + 1000);
    }

    // Function to logout of admin mode
    function adminLogout() {
      if (!isAdmin) return;
      
      isAdmin = false;
      localStorage.removeItem('isAdmin');
      document.getElementById('adminToggle').style.display = 'none';
      document.getElementById('adminPanel').style.display = 'none';
      alert("Admin mode deactivated!");
    }

    // ======================
    // INITIALIZE EVERYTHING
    // ======================
    document.addEventListener('DOMContentLoaded', () => {
      checkAdminStatus();
      initializeMessages();
      
      if (floatingCatsEnabled) {
        spawnFloatingCats();
      }
      
      // Setup message input to send on Enter key
      document.getElementById('userMessage').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          saveMessage();
        }
      });
    });
  </script>
</body>
</html>
